(self.webpackChunkweb=self.webpackChunkweb||[]).push([[194],{1477:(r,e,a)=>{"use strict";a.d(e,{y:()=>v});var t=a(4575),n=a.n(t),o=a(3913),i=a.n(o),s=a(383),l=a(235),u=a(8484),d=a(9118),c=a(5797),h=a(4964),_=function(){function r(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n()(this,r),this._code=r.get_code(e),this._code&&r.check(this._code,a)?(this._value=a,void(this._data=r.make_data(this._value))):null}return i()(r,[{key:"code",get:function(){return this._code}},{key:"value",get:function(){return this._value}},{key:"data",get:function(){return this._data}},{key:"size",get:function(){return this._data.length}}],[{key:"make_data",value:function(r){return null===r?[]:"string"==typeof r?d.O.parse(r,c.Nm.text.value):r instanceof Array?r:"number"==typeof r&&Number.isInteger(r)?(0,u.Y)(d.O.parse(r,c.Nm.uint32be.value)):null}},{key:"get_code",value:function(r){if("string"==typeof r){if(!(r in s.Kw))return null;r=op.code}return Object.values(s.Kw).find((function(e){return e.code==r}))?r:null}},{key:"check",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(e=r.get_code(e)))return"code not found";var t=s.eS(e);if(!t)return"op not found [".concat(t,"]");switch(t.type){case"empty":return null==a||"invalid type";case"uint":if("number"!=typeof a||!Number.isInteger(a))return"invalid type";if(a<Math.pow(2,8*t.min)-1||a>Math.pow(2,8*t.max)-1)return"out of bound";break;case"string":if("string"!=typeof a)return"invalid type";if(a.length<t.min||a.length>t.max)return"out of bound";break;case"opaque":if(!(a instanceof Array))return"invalid type";if(a.length<t.min||a.length>t.max)return"out of bound";if(!h.H.is_uint8_array(a))return"invalid value";break;default:return"invalid type type"}return!0}},{key:"make_block",value:function(r,e,a){return a|(e?1:0)|r<<4}},{key:"szx_2_block_size",value:function(r){return Math.pow(2,r+4)}},{key:"block_size_2_szx",value:function(r){return Math.log2(r)-4}},{key:"parse_block",value:function(e){var a=7&e;return{szx:a,more:(8&e)>>3,number:e>>4,size:7==a?"BERT":r.szx_2_block_size(a)}}},{key:"process",value:function(e,a){var t=s.eS(e);if(!t)return{value:null,data:null,special:null,error:["option not found"],has_error:!0};var n=null;if(t.value==s.Kw.block1.value||t.value==s.Kw.block2.value){var o=+d.O.to(a,c.Nm.uint32be.value),i=r.parse_block(o);n="".concat(i.number,"/").concat(i.more?"M":"_","/").concat(i.size,"(").concat(i.szx,")")}else if(t.value==s.Kw.no_response.value){var l=+d.O.to(a,c.Nm.uint32be.value),u=[];s.iA.success.code&l&&u.push(s.iA.success.name),s.iA.client_error.code&l&&u.push(s.iA.client_error.name),s.iA.server_error.code&l&&u.push(s.iA.server_error.name),n=u.join("/")}else if(t.value==s.Kw.accept.value||t.value==s.Kw.content_format.value){var h=+d.O.to(a,c.Nm.uint32be.value),_=s.RN(h);n=_?_.name:null}switch(t.type){case"empty":return a.length?{value:t.value,data:a,str_data:d.O.to(a,c.Nm.hex.value),special:n,error:["incompatiable data"],has_error:!0}:{value:t.value,data:null,str_data:"",special:n,error:[],has_error:!1};case"string":var v=d.O.to(a,c.Nm.text.value);return{value:t.value,data:v,str_data:v,special:n,error:[],has_error:!1};case"uint":var f=+d.O.to(a,c.Nm.uint32be.value);return{value:t.value,data:+f,str_data:f,special:n,error:[],has_error:!1};case"opaque":return{value:t.value,data:a,str_data:d.O.to(a,c.Nm.hex.value),special:n,error:[],has_error:!1}}return null}},{key:"parse",value:function(r,e){if(!Array.isArray(r)||"number"!=typeof e)return{data:[],error:["type error"],has_error:!0};if(!r.length)return{data:[],error:["argument too short"],has_error:!0};if(r[0]==s.Li)return{data:[],error:["payload marker"],has_error:!0};var a=r[0]>>4,t=0,n=15&r[0],o=0,i=1;if(r.shift(),a>12)if(13==a){if(!r.length)return{data:[],error:["argument too short"],has_error:!0};t=e+r[0]+13,r.shift(),i+=1}else{if(14!=a)return{data:[],error:["invalid data"],has_error:!0};if(r.length<2)return{data:[],error:["argument too short"],has_error:!0};t=e+(r[0]<<8|r[1])+269,r.shift(),r.shift(),i+=2}else t=e+a;if(n>12)if(13==n){if(!r.length)return{data:[],error:["argument too short"],has_error:!0};o=e+r[0]+13,r.shift(),i+=1}else{if(14!=n)return{data:[],error:["invalid data"],has_error:!0};if(r.length<2)return{data:[],error:["argument too short"],has_error:!0};o=e+(r[0]<<8|r[1])+269,r.shift(),r.shift(),i+=2}else o=n;if(i+=o,r.length<o)return{data:[],error:["argument too short"],has_error:!0};for(var l=[],u=0;u<o;u++)l.push(r.shift());return{data:{code:t,length:o,data:l,size:i},error:[],has_error:!1}}},{key:"serialize",value:function(r,e){var a=[],t=r.code-e,n=0,o=0;t>12?t<269?(n=13,o=t-13):(n=14,o=t-269):n=t;var i=r.size,s=0;switch(r.size>12?r.size<269?(i=13,s=r.size-13):(i=14,s=r.size-269):i=r.size,a.push(n<<4|i),n){case 13:a.push(o);break;case 14:a.push(o>>8),a.push(255&o)}switch(i){case 13:a.push(s);break;case 14:a.push(s>>8),a.push(255&s)}return r.size&&(a=a.concat(r.data)),{data:a,error:[],has_error:!1}}}]),r}(),v=function(){function r(){n()(this,r)}return i()(r,null,[{key:"serialize_header",value:function(r,e,a,t){var n=[];if("string"==typeof r){if(!(r in s.dt))return null;r=s.dt[r].code}if(!(0,l.wI)(r))return{data:n,error:["invalid type"],has_error:!0};if("string"==typeof e){if(!(r in s.TU))return{data:n,error:["invalid code"],has_error:!0};e=s.TU[e].code}if(!(0,l.sS)(e))return{data:n,error:["invalid code"],has_error:!0};if("string"==typeof t&&(t=d.O.parse(t,c.Nm.uint8.value)),!(0,l.js)(t))return{data:n,error:["invalid token"],has_error:!0};if(!(0,l.XZ)(a))return{data:n,error:["invalid mid"],has_error:!0};var o=s.i8<<30|r<<28|t.length<<24|e<<16|a;return n=d.O.parse(o,c.Nm.uint32be.value),t.length&&(n=n.concat(t)),{data:n,error:[],has_error:!1}}},{key:"serialize_header_realiable",value:function(r,e){var a=[];if("string"==typeof r){if(!(type in s.TU))return{data:a,error:["invalid code"],has_error:!0};r=s.TU[r].code}return(0,l.sS)(r)?("string"==typeof e&&(e=d.O.parse(e,c.Nm.uint8.value)),(0,l.js)(e)?(a.push(e.length,r),e.length&&(a=a.concat(e)),{data:a,error:[],has_error:!1}):{data:a,error:["invalid token"],has_error:!0}):{data:a,error:["invalid code"],has_error:!0}}},{key:"serialize_options",value:function(r){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=[];if(!(0,l.s$)(r,e))return{data:a,error:["invalid options"],has_error:!0};r.sort((function(r,e){return r.code-e.code}));var t=0;return r.forEach((function(r){var e=_.serialize(r,t);e.has_error||(a=a.concat(e.data)),t=r.code})),{data:a,error:[],has_error:!1}}},{key:"serialize_payload",value:function(r){if("string"==typeof r)try{r=d.O.parse(r,c.Nm.uint8.value)}catch(r){return{data:[],error:["invalid payload"],has_error:!0}}return r instanceof Array?r.length?{data:[s.Li].concat(r),error:[],has_error:!1}:{data:[],error:[],has_error:!1}:{data:[],error:["invalid payload"],has_error:!0}}},{key:"serialize",value:function(e,a,t,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=[],l=r.serialize_header(e,a,t,n);if(s=s.concat(l.data),l.has_error)return{data:s,conn_type:"unreliable",error:l.error,has_error:!0};var u=r.serialize_options(o);if(s=s.concat(u.data),u.has_error)return{data:s,conn_type:"unreliable",error:u.error,has_error:!0};var d=r.serialize_payload(i);return{data:s=s.concat(d.data),conn_type:"unreliable",error:d.error,has_error:d.has_error}}},{key:"serialize_reliable",value:function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=[],s=r.serialize_header_realiable(e,a);if(i=i.concat(s.data),s.has_error)return{data:i,conn_type:"reliable",setted_length:o,error:s.error,has_error:!0};var l=r.serialize_options(t);if(i=i.concat(l.data),l.has_error)return{data:i,conn_type:"reliable",setted_length:o,error:l.error,has_error:!0};var u=r.serialize_payload(n);if(i=i.concat(u.data),u.has_error)return{data:i,conn_type:"reliable",setted_length:o,error:u.error,has_error:u.has_error};if(o){var h=0,_=0,v=i.length-2-a.length;if(v<13||(v<269?(h=13,_=1,v-=13):v<65805?(h=14,_=2,v-=269):(h=15,_=3,v-=65805)),i[0]|=0!=h?h<<4:v<<4,_){for(v=d.O.parse(v,c.Nm.uint32be.value);v.length!=_;)v.pop();i=[i[0]].concat(v).concat(i.slice(1))}}return{data:i,conn_type:"reliable",setted_length:o,error:[],has_error:!1}}},{key:"parse_options",value:function(r){for(var e=[],a=0,t=0;r[0]!=s.Li;){var n=_.parse(r,a);if(n.has_error)return{data:e,error:[{option:n,error:n.error}],has_error:!0};var o=_.process(n.data.code,n.data.data);if(n.data.op_value=o.value,n.data.value=o.data,n.data.str_data=o.str_data,n.data.special=o.special,n.data.error=o.error,n.data.checked=_.check(n.data.code,o.data),e.push(n),a=n.data.code,t+=n.data.size,!r.length)break}return{data:e,size:t,error:[],has_error:!1}}},{key:"parse",value:function(e){if(!Array.isArray(e))return{data:{},conn_type:"unreliable",size:0,error:["argument error"],has_error:!0};var a={},t=e.length;if(e.length<4)return{data:a,size:t,conn_type:"unreliable",error:["data too short"],has_error:!0};if(a.version=e[0]>>6,a.version!=s.i8)return{data:a,size:t,conn_type:"unreliable",error:["invalid version"],has_error:!0};var n=e[0]>>4&3;a.type={code:n,value:Object.values(s.dt).find((function(r){return r.code==n})).value};var o=e[1],i=Object.values(s.TU).find((function(r){return r.code==o}));if(a.code={code:o,value:i?i.value:null},a.mid={data:e.slice(2,4)},a.mid.value=a.mid.data[0]<<8|a.mid.data[1],a.token_len=15&e[0],a.token_len>8)return{data:a,size:t,conn_type:"unreliable",error:["invalid token size"],has_error:!0};if(e.length<4+a.token_len)return{data:a,size:t,conn_type:"unreliable",error:["data too short"],has_error:!0};if(a.token=a.token_len?e.slice(4,4+a.token_len):[],e.length>4+a.token_len){if(a.options=r.parse_options(e.slice(4+a.token_len)),a.options.has_error)return{data:a,size:t,conn_type:"unreliable",error:a.options.error,has_error:!0};e[4+a.token_len+a.options.size]==s.Li?a.payload=e.slice(4+a.token_len+a.options.size+1):a.payload={data:[],error:[],has_error:!1}}else a.options={data:[],size:0,error:[],has_error:!1},a.payload={data:[],error:[],has_error:!1};return{data:a,size:t,conn_type:"unreliable",error:[],has_error:!1}}},{key:"parse_reliable",value:function(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e))return{data:{},conn_type:"reliable",setted_length:a,size:0,error:["argument error"],has_error:!0};var t={},n=e.length;if(e.length<2)return{data:t,size:n,conn_type:"reliable",setted_length:a,error:["data too short"],has_error:!0};var o=e[0]>>4;if(!a&&0!=o)return{data:t,size:n,setted_length:a,conn_type:"reliable",error:["invalid length"],has_error:!0};var i=1;if(a)switch(o){case 13:t.length=13+e[1],i=2;break;case 14:t.length=269+(e[1]<<8|e[2]),i=3;case 15:t.length=65805+(e[1]<<16|e[2]<<8|e[1]),i=4;default:t.length=o}else t.length=0;if(t.token_len=15&e[0],t.token_len>8)return{data:t,size:n,setted_length:a,conn_type:"reliable",error:["invalid token size"],has_error:!0};var l=1+i+t.token_len;n=a?t.length+l:e.length;var u=e[i],d=s.Ed(u);if(t.code={code:u,value:d?d.value:null},e.length<l)return{data:t,size:n,header_size:l,setted_length:a,conn_type:"reliable",error:["data too short"],has_error:!0};if(t.token=t.token_len?e.slice(l-t.token_len,l):[],n>l){if(t.options=r.parse_options(e.slice(l)),t.options.has_error)return{data:t,size:n,header_size:l,setted_length:a,conn_type:"reliable",error:t.options.error,has_error:!0};e[l+t.options.size]==s.Li?t.payload=e.slice(l+t.options.size+1):t.payload={data:[],error:[],has_error:!1}}else t.options={data:[],size:0,error:[],has_error:!1},t.payload={data:[],error:[],has_error:!1};return{data:t,size:n,header_size:l,setted_length:a,conn_type:"reliable",error:[],has_error:!1}}}]),r}();v.option=_}}]);